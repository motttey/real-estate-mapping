<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8"/>
    <title>Town map</title>
  </head>
  <body>
    <div id="main">
      <div id="map_div" style="position:fixed;">
        <svg id="map"> </svg>
      </div>
      <div id="hull_div" style="position:fixed;">
        <svg id="hull"> </svg>
      </div>
      <div id="plot_div" style="position:fixed;">
        <svg id="plot"> </svg>
      </div>
      <div id="anotation_div" style="position:fixed; pointer-events: none;">
        <svg id="anotation"> </svg>
      </div>
    </div>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="./main.js"></script>

    <script type="text/javascript">
      const stations = [
        {"id": 0, "name": "Yokohama", "lng": 139.6201192, "lat": 35.4657901},
        {"id": 1, "name": "Ebisu", "lng": 139.709739, "lat": 35.647156},
        {"id": 2, "name": "Kichijoji", "lng": 139.58, "lat": 35.703056},
        {"id": 3, "name": "Shinagawa", "lng": 139.736571, "lat": 35.6284756},
        {"id": 4, "name": "Ikebukuro", "lng": 139.7087114, "lat": 35.7295071},
        {"id": 5, "name": "Musashikosugi", "lng": 139.657272, "lat": 35.5766378},
        {"id": 6, "name": "Shinjuku", "lng": 139.6895924, "lat": 35.6982244},
        {"id": 7, "name": "Meguro", "lng": 139.7212501, "lat": 35.6285136},
        {"id": 8, "name": "Omiya", "lng": 139.6216608, "lat": 35.9064528},
        {"id": 9, "name": "Urawa", "lng": 139.6562868, "lat": 35.8583478},
        {"id": 10, "name": "Shibuya", "lng": 139.6994471, "lat": 35.6580382},
        {"id": 11, "name": "Nakameguro", "lng": 139.6966557, "lat": 35.6441631},
        {"id": 12, "name": "Jiyugaoka", "lng": 139.6657348, "lat": 35.6074068},
        {"id": 13, "name": "Kamakura", "lng": 139.5105125, "lat": 35.331778},
        {"id": 14, "name": "Nakano", "lng": 139.663569, "lat": 35.7056142},
        {"id": 15, "name": "Futakotamagawa", "lng": 139.6252443, "lat": 35.6123586},
        {"id": 16, "name": "Funabashi", "lng": 139.9826962, "lat": 35.7017527},
        {"id": 17, "name": "Akabane", "lng": 139.7163193, "lat": 35.7795679},
        {"id": 18, "name": "Kawasaki", "lng": 139.694695, "lat": 35.5313693},
        {"id": 19, "name": "Kashiwa", "lng": 139.9687232, "lat": 35.8621541},
        {"id": 20, "name": "Tachikawa", "lng": 139.4115521, "lat": 35.6979144},
        {"id": 21, "name": "Kitasenju", "lng": 139.8031493, "lat": 35.7496806},
        {"id": 22, "name": "Ogikubo", "lng": 139.603315, "lat": 35.70471},
        {"id": 23, "name": "Omotesando", "lng": 139.7098981, "lat": 35.6652554},
        {"id": 24, "name": "Ebina", "lng": 139.3887433, "lat": 35.4526059},
        {"id": 25, "name": "Sakuragicho", "lng": 139.6288723, "lat": 35.4509537},
        {"id": 26, "name": "Tsudanuma", "lng": 140.0182132, "lat": 35.6912192},
        {"id": 27, "name": "Saitama-Shintoshin", "lng": 139.631547, "lat": 35.8937993},
        {"id": 28, "name": "Ueno", "lng": 139.7752151, "lat": 35.7141715},
        {"id": 31, "name": "Sangenchaya", "lng": 139.6692071, "lat": 35.643621},
        {"id": 32, "name": "Machida", "lng": 139.4630475, "lat": 35.5498564},
        {"id": 33, "name": "Akihabara", "lng": 139.7709203, "lat": 35.6983573},
        {"id": 34, "name": "Fujisawa", "lng": 139.485438, "lat": 35.3385319},
        {"id": 35, "name": "Chohu", "lng": 139.5426079, "lat": 35.6517667},
        {"id": 36, "name": "Shimokitazawa", "lng": 139.664788, "lat": 35.6615272},
        {"id": 37, "name": "Mitaka", "lng": 139.5588351, "lat": 35.7027199},
        {"id": 38, "name": "Kawagoe", "lng": 139.458202, "lat": 35.9044475},
        {"id": 39, "name": "Tama-Praza", "lng": 139.5563338, "lat": 35.5774101},
        {"id": 29, "name": "Maihama", "lng": 139.885078, "lat": 35.6349019},
        {"id": 41, "name": "Mito", "lng": 140.4740061, "lat": 36.3704111},
        {"id": 42, "name": "Wakohshi", "lng": 139.6101589, "lat": 35.7870234},
        {"id": 43, "name": "Urayasu", "lng": 139.893256, "lat": 35.665883},
        {"id": 44, "name": "Huchu", "lng": 139.4779897, "lat": 35.6724309},
        {"id": 45, "name": "Minato-Mirai", "lng": 139.6329595, "lat": 35.4572221},
        {"id": 46, "name": "Toyosu", "lng": 139.7954518, "lat": 35.653739},
        {"id": 47, "name": "Nagareyama-Otakanomori", "lng": 139.9228539, "lat": 35.8718111},
        {"id": 48, "name": "Tokorozawa", "lng": 139.4710359, "lat": 35.7866173},
        {"id": 49, "name": "Yoyogi-Uehara", "lng": 139.6775445, "lat": 35.6690026},
        {"id": 50, "name": "Shin-Urayasu", "lng": 139.91256, "lat": 35.649497},
        {"id": 51, "name": "Tsukuba", "lng": 140.1117097, "lat": 36.0825102},
        // {"id": 52, "name": "Yurakucho", "lng": 139.7628199, "lat": 35.6749187},
        {"id": 52, "name": "Yoyogi", "lng": 139.6998668, "lat": 35.683033},
        {"id": 53, "name": "Chiba", "lng": 140.1112894, "lat": 35.6129259},
        {"id": 54, "name": "Koenji", "lng": 139.6476126, "lat": 35.705324},
        {"id": 55, "name": "Nishifunabashi", "lng": 139.9567781, "lat": 35.7074693},
        // {"id": 57, "name": "Kenkyu-Gakuen", "lng": 140.0801813, "lat": 36.082114},
        {"id": 56, "name": "Kawaguchi", "lng": 139.7155782, "lat": 35.7991926},
        {"id": 57, "name": "Sagamiohno", "lng": 139.4343461, "lat": 35.5324612},
        {"id": 58, "name": "Tsujido", "lng": 139.4448987, "lat": 35.3368951},
        {"id": 59, "name": "Ofuna", "lng": 139.5291102, "lat": 35.3540475},
        {"id": 60, "name": "Motoyawata", "lng": 139.9250454, "lat": 35.7210914},
        {"id": 61, "name": "Nerima", "lng": 139.6278647, "lat": 35.7338669},
        {"id": 62, "name": "Ichikawa", "lng": 139.908197, "lat": 35.728821},
        {"id": 63, "name": "Ohsaki", "lng": 139.7261369, "lat": 35.6194836},
        {"id": 64, "name": "Mejiro", "lng": 139.7044228, "lat": 35.7212199},
        {"id": 65, "name": "Kamiooka", "lng": 139.59593, "lat": 35.409182},
        {"id": 66, "name": "Ohimachi", "lng": 139.7324695, "lat": 35.6072409},
        {"id": 67, "name": "Daikanyama", "lng": 139.7009593, "lat": 35.6480919},
        {"id": 68, "name": "Moriya", "lng": 139.9900742, "lat": 35.9507748},
      ];

      const stations_2 = [
        {"id": 71, "name": "Shin-yurigaoka", "lng": 139.5054741, "lat": 35.603981},
        {"id": 72, "name": "Asakusa", "lng": 139.7955734, "lat": 35.7107924},
        {"id": 73, "name": "Totsuka", "lng": 139.5342039, "lat": 35.4007664},
        {"id": 74, "name": "IIdabashi", "lng": 139.7450071, "lat": 35.7020673},
        // {"id": 75, "name": "Aoyama-icchome", "lng": 139.5342039, "lat": 35.4007664},
        {"id": 76, "name": "Matsudo", "lng": 139.9006607, "lat": 35.7843004},
        {"id": 77, "name": "Kiyosumi-Shirakawa", "lng": 139.7987778, "lat": 35.6822525},
        {"id": 78, "name": "Komagome", "lng": 139.7448211, "lat": 35.7365665},
        {"id": 79, "name": "Roppongi", "lng": 139.7291728, "lat": 35.6627953},
        {"id": 80, "name": "Asagaya", "lng": 139.6336703, "lat": 35.704872},
        {"id": 81, "name": "Hashimoto", "lng": 139.3427337, "lat": 35.5948639},
        {"id": 82, "name": "Musashi-Urawa", "lng": 139.644576, "lat": 35.8457154},
        {"id": 83, "name": "Kinshicho", "lng": 139.8122254, "lat": 35.6967252},
        {"id": 84, "name": "Chigasaki", "lng": 139.4046408, "lat": 35.3303039},
        {"id": 85, "name": "Myogadani", "lng": 139.7345912, "lat": 35.7173731},
        {"id": 86, "name": "Azabu-juban", "lng": 139.7346926, "lat": 35.6561336},
        {"id": 87, "name": "Kaihin-Makuhari", "lng": 140.0397773, "lat": 35.648417},
        {"id": 88, "name": "Nishiogikubo", "lng": 139.5995195, "lat": 35.7036906},
        {"id": 89, "name": "Kagurazaka", "lng": 139.734518, "lat": 35.703819},
        {"id": 90, "name": "Kokubunji", "lng": 139.4802037, "lat": 35.7001246},
        {"id": 91, "name": "Katsuta", "lng": 140.5198913, "lat": 36.393788},
        {"id": 92, "name": "Oshiage", "lng": 139.8134874, "lat": 35.7111618},
        {"id": 93, "name": "Hiroo", "lng": 139.7201063, "lat": 35.6508413},
        {"id": 94, "name": "Minamiurawa", "lng": 139.6671396, "lat": 35.8475733},
        {"id": 95, "name": "Shin-Yokohama", "lng": 139.6153827, "lat": 35.5068127},
        {"id": 96, "name": "Motosumiyoshi", "lng": 139.6518508, "lat": 35.5643213},
        {"id": 97, "name": "Hiyoshi", "lng": 139.6447741, "lat": 35.5533679},
        {"id": 98, "name": "Nippori", "lng": 139.7685304, "lat": 35.7279344},
        {"id": 99, "name": "Nakano-Shinbashi", "lng": 139.6715573, "lat": 35.691958},
        {"id": 100, "name": "Gotanda", "lng": 139.7214135, "lat": 35.6261591},
        {"id": 101, "name": "Narita", "lng": 140.313605, "lat": 35.777327},
        {"id": 102, "name": "Sugamo", "lng": 139.7392893, "lat": 35.7334129},
        {"id": 103, "name": "Odawara", "lng": 139.1532045, "lat": 35.2564449},
        {"id": 104, "name": "Tamachi", "lng": 139.7476498, "lat": 35.6456529},
        {"id": 105, "name": "Ochanomizu", "lng": 139.7652479, "lat": 35.6993854},
        {"id": 106, "name": "Center-Kita", "lng": 139.5762933, "lat": 35.553138},
        {"id": 107, "name": "Enoshima", "lng": 139.4854767, "lat": 35.3109957},
        {"id": 108, "name": "Minaminagareyama", "lng": 139.9020593, "lat": 35.837809},
        {"id": 109, "name": "Hachioji", "lng": 139.3388529, "lat": 35.6556157},
        {"id": 110, "name": "Tsuchiura", "lng": 140.2040233, "lat": 36.078484},
        {"id": 111, "name": "Kotake-mukaihara", "lng": 139.6773323, "lat": 35.743341},
        {"id": 112, "name": "Tsurumi", "lng": 139.6716141, "lat": 35.4960216},
        {"id": 113, "name": "Musashikoyama", "lng": 139.7020021, "lat": 35.6203424},
        {"id": 114, "name": "Furukawa", "lng": 139.7073663, "lat": 36.194597},
        {"id": 115, "name": "Inage", "lng": 140.09249, "lat": 35.63717},
        {"id": 116, "name": "Korakuen", "lng": 139.751822, "lat": 35.708486},
        {"id": 117, "name": "Keikyu-Kawasaki", "lng": 139.6984418, "lat": 35.532621},
        {"id": 118, "name": "Kunitachi", "lng": 139.4441873, "lat": 35.699173},
        {"id": 119, "name": "Denen-Chohu", "lng": 139.6673414, "lat": 35.5968484},
        {"id": 120, "name": "Sasazuka", "lng": 139.6649473, "lat": 35.673654},
        {"id": 121, "name": "Kannai", "lng": 139.6333091, "lat": 35.4439663},
        {"id": 122, "name": "Gakugei-Daigaku", "lng": 139.6830583, "lat": 35.628743},
        {"id": 123, "name": "Aobadai", "lng": 139.5159342, "lat": 35.5420693},
        {"id": 124, "name": "Tsukishima", "lng": 139.7818958, "lat": 35.663861},
        {"id": 125, "name": "Shakujii-Koen", "lng": 139.6043663, "lat": 35.743645},
        {"id": 126, "name": "Takadanobaba", "lng": 139.7018977, "lat": 35.7130938},
        {"id": 127, "name": "Mizonokuchi", "lng": 139.6106234, "lat": 35.5999649},
        {"id": 128, "name": "Ageo", "lng": 139.586629, "lat": 35.9735224},
        {"id": 129, "name": "Fujimino", "lng": 139.5209783, "lat": 35.860896},
        {"id": 130, "name": "Shin-Koshigaya", "lng": 139.789783, "lat": 35.8756114},
      ]
      const width = 1500;
      const height = 1500;

      const city_length = 69;

      console.log(stations);
      const zoom = d3.zoom()
       .scaleExtent([1, 40])
       .translateExtent([[0,0], [width, height]])
       .extent([[0, 0], [width, height]])
       .on("zoom", zoomed);

      // ボタンなどのUIと関連付けて表示/非表示できるようにする
      var visible_towns = [0,1,2,3,4,5,6,7,8,9,10,11,12];

      var svg = d3.select("#map")
        .attr("width", width)
        .attr("height", height)
        .style("background-color", "black");

      var plots_svg = d3.select("#plot")
        .attr("width", width)
        .attr("height", height)
        .call(zoom);

      var hulls_svg = d3.select("#hull")
        .attr("width", width)
        .attr("height", height);

      var anotation_svg = d3.select("#anotation")
        .attr("width", width)
        .attr("height", height);

      var tooltip = d3.select("#main")
          .append("div")
          .attr("id", "tooltip")
          .style("position", "absolute")
          .style("visibility", "hidden")
          .text("tooltip");

      var projection = d3.geoMercator()
          .center([ 139.70, 35.64 ])
          .translate([width/2, height/2])
          .scale(54000);

      // https://easyramble.com/latitude-and-longitude-per-kilometer.html
      var kilometor = projection([0.0090133729745762, 0])[0] - projection([0, 0])[0];
      console.log(kilometor);

      const red_gray_grad = d3.interpolate("red", "gray");
      const green_gray_grad = d3.interpolate("green", "gray");
      const while_blue_grad = d3.interpolate("black", "blue");

      $.when(
        plotPrefecture(11, projection, 1000000),
        plotPrefecture(12, projection, 1000000),
        plotPrefecture(13, projection, 1000000),
        plotPrefecture(14, projection, 1000000),
        plotAllEstate(projection),
      ).done(function(){
        plotStations(projection, stations);
        plotStations(projection, stations_2);
      });

      function zoomed() {
        d3.selectAll("g").attr("transform", d3.event.transform);
      }


    </script>
  </body>
</html>
