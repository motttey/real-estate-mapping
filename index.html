<!DOCTYPE html>
<html>
  <body>
    <div id="main">
      <svg id="map"></svg>
    </div>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

    <script type="text/javascript">

      const width = 1500;
      const height = 1500;

      $.get("./JapanCityGeoJson/geojson/prefectures/13.json", function(data){
      	var data_parsed = $.parseJSON(data);
        var projection = d3.geoMercator()
                    .center([ 139.70, 35.64 ])
                    .translate([width/2, height/2])
                    .scale(150000);

        var geoPath = d3.geoPath().projection(projection);
        var svg = d3.select("#map")
          .attr("width",width)
          .attr("height",height);

        var map = svg.selectAll("path").data(data_parsed.features)
          .enter()
          .append("path")
            .attr("d", geoPath)
            .style("stroke", "#5EAFC6")
            .style("stroke-width", 1)
            .style("fill", "#ffffff");

        // plotCoordinates(projection, "output_yokohama.json", "ebisu", "red");


        plotCoordinates(projection, "output_ebisu.json", "ebisu", "red");
        plotCoordinates(projection, "output_sinjuku.json", "sinjuku", "cyan");
        plotCoordinates(projection, "output_shinagawa.json", "shinagawa", "yellow");
        plotCoordinates(projection, "output_meguro.json", "meguro", "orange");
        plotCoordinates(projection, "output_ikebukuro.json", "ikebukuro", "green");
        plotCoordinates(projection, "output_kichijoji.json", "kichijoji", "blue");

      });

      function plotCoordinates(projection, filename, id, color){
        $.get("./" + filename, function(coordinates_raw){
          var projected_coordinate = [];
          var coordinates = $.parseJSON(coordinates_raw);
          console.log(coordinates);

          coordinates.forEach(function(d){
            projected_coordinate.push(projection([d["lng"], d["lat"]]));
          });

          var circles_g = d3.select("svg").append('g')
                  .attr('id', 'circles_' + id);

          var circles = circles_g.selectAll("circle")
                  .data(projected_coordinate)
                  .enter()
                  .append('circle')
                  .attr('cx', function(d){
                    return d[0];
                  })
                  .attr('cy', function(d){
                    return d[1];
                  })
                  .attr('r', 2)
                  .attr('stroke', color)
                  .attr('fill', color);
        });
      }
    </script>
  </body>
</html>
